import hashlib
import requests
import sys

API_KEY = "ae8ce7fa8d3a12cfd8b67def9036ed89fc9cce3a71b10320eb0e2548fe989181"

def get_sha256(file_path):
	sha256_hash = hashlib.sha256()
	with open(file_path, "rb") as f:
		for byte_block in iter(lambda: f.read(4096), b""):
			sha256_hash.update(byte_block)
	return sha256_hash.hexdigest()

def query_virustotal(sha256):
	url = f"https://www.virustotal.com/api/v3/files/{sha256}"
	headers = {
		"x-apikey":API_KEY
	}
	response = requests.get(url, headers=headers)
	if response.status_code == 200:
		data = response.json()
		stats = data["data"]["attributes"]["last_analysis_stats"]
		print("\n VirusTotal Scan REsult: ")
		print(f" - Malicious: {stats['malicious']} ")
		print(f" - Suspicous: {stats['suspicious']}")
		print(f" - Harmless: {stats['harmless']}")
		print(f" - Undetected: {stats['undetected']}")
	elif response.status_code == 404:
		print("[!] File not found on VirusTotal.")
	else:
		print(f"[!] Error: {response.status_code} - {response.text}")

if __name__ == "__main__":
	if len(sys.argv) != 2:
		print("Usage: python3 12_malware_hash_checker.py <file_path>")
		sys.exit(1)

	file_path = sys.argv[1]
	print(f"\n Scanning file: {file_path}")
	sha256 = get_sha256(file_path)
	print(f" - SHA256: {sha256}")
	query_virustotal(sha256)
